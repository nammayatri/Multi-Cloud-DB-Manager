# Dual Database Manager - Kubernetes Secret (example)
#
# 1. Copy this file to secrets.yaml:
#    cp secrets.yaml.example secrets.yaml
# 2. Replace all placeholders in secrets.yaml with your real values.
# 3. Do NOT commit secrets.yaml (it is in .gitignore).
#
# DATABASE_CONFIGS and REDIS_CONFIGS must be base64-encoded JSON.
# To generate: echo -n '<json>' | base64
# To decode:   echo '<base64>' | base64 -d
#
apiVersion: v1
kind: Secret
metadata:
  name: dual-db-secrets
  namespace: <NAMESPACE>   # Replace with your namespace (e.g. default, dual-db-manager)
  labels:
    app: dual-db-manager
type: Opaque
stringData:
  # ──────────────────────────────────────────────────────────────────────────
  # DATABASE_CONFIGS — base64-encoded JSON
  # ──────────────────────────────────────────────────────────────────────────
  # Decoded structure:
  # {
  #   "primary": {
  #     "cloudName": "cloud1",
  #     "db_configs": [
  #       {
  #         "name": "db1",
  #         "label": "Primary DB",
  #         "host": "YOUR_DB_HOST",
  #         "port": 5432,
  #         "user": "YOUR_DB_USER",
  #         "password": "YOUR_DB_PASSWORD",
  #         "database": "YOUR_DB_NAME",
  #         "schemas": ["public", "app_schema"],
  #         "defaultSchema": "public",
  #         "publicationName": "my_publication"       <-- optional, for logical replication
  #       }
  #     ]
  #   },
  #   "secondary": [
  #     {
  #       "cloudName": "cloud2",
  #       "db_configs": [
  #         {
  #           "name": "db1",
  #           "label": "Primary DB",
  #           "host": "YOUR_SECONDARY_DB_HOST",
  #           "port": 5432,
  #           "user": "YOUR_DB_USER",
  #           "password": "YOUR_DB_PASSWORD",
  #           "database": "YOUR_DB_NAME",
  #           "schemas": ["public", "app_schema"],
  #           "defaultSchema": "public",
  #           "subscriptionName": "my_subscription"   <-- optional, for logical replication
  #         }
  #       ]
  #     }
  #   ],
  #   "history": {
  #     "host": "YOUR_HISTORY_DB_HOST",
  #     "port": 5432,
  #     "user": "YOUR_HISTORY_DB_USER",
  #     "password": "YOUR_HISTORY_DB_PASSWORD",
  #     "database": "YOUR_HISTORY_DB_NAME"
  #   },
  #   "slack": {                                      <-- optional, for replication alerts
  #     "botToken": "xoxb-YOUR-SLACK-BOT-TOKEN",
  #     "channels": ["#replication-alerts"]
  #   }
  # }
  #
  # Supports ${VAR_NAME} placeholders in JSON values — they are substituted
  # at startup from environment variables or Kubernetes secrets (${SECRET:name:key}).
  #
  DATABASE_CONFIGS: |
    eyJwcmltYXJ5Ijp7ImNsb3VkTmFtZSI6InByaW1hcnkiLCJkYl9jb25maWdzIjpbeyJuYW1lIjoiZGIxIiwibGFiZWwiOiJQcmltYXJ5IERCIiwiaG9zdCI6IllPVVJfREJfSE9TVCIsInBvcnQiOjU0MzIsInVzZXIiOiJZT1VSX0RCX1VTRVIiLCJwYXNzd29yZCI6IllPVVJfREJfUEFTU1dPUkQiLCJkYXRhYmFzZSI6IllPVVJfREJfTkFNRSIsInNjaGVtYXMiOlsicHVibGljIl0sImRlZmF1bHRTY2hlbWEiOiJwdWJsaWMifV19LCJzZWNvbmRhcnkiOltdLCJoaXN0b3J5Ijp7Imhvc3QiOiJZT1VSX0hJU1RPUllfSE9TVCIsInBvcnQiOjU0MzIsInVzZXIiOiJZT1VSX0hJU1RPUllfVVNFUiIsInBhc3N3b3JkIjoiWU9VUl9ISVNUT1JZX1BBU1NXT1JEIiwiZGF0YWJhc2UiOiJZT1VSX0hJU1RPUllfREIifX0=

  # ──────────────────────────────────────────────────────────────────────────
  # REDIS_CONFIGS — base64-encoded JSON (required for Redis Manager feature)
  # ──────────────────────────────────────────────────────────────────────────
  # Decoded structure:
  # {
  #   "primary": {
  #     "cloudName": "cloud1",
  #     "host": "YOUR_REDIS_HOST",
  #     "port": 6379
  #   },
  #   "secondary": [
  #     {
  #       "cloudName": "cloud2",
  #       "host": "YOUR_SECONDARY_REDIS_HOST",
  #       "port": 6379
  #     }
  #   ]
  # }
  #
  # If omitted, Redis Manager feature will be disabled (DB Manager still works).
  #
  REDIS_CONFIGS: |
    eyJwcmltYXJ5Ijp7ImNsb3VkTmFtZSI6InByaW1hcnkiLCJob3N0IjoiWU9VUl9SRURJU19IT1NUIiwicG9ydCI6NjM3OX0sInNlY29uZGFyeSI6W119

  # ──────────────────────────────────────────────────────────────────────────
  # Session secret — use a long random string in production
  # Generate: openssl rand -hex 32
  # ──────────────────────────────────────────────────────────────────────────
  SESSION_SECRET: "REPLACE_WITH_LONG_RANDOM_SESSION_SECRET"
